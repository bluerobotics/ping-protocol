{
    "class_info": {
        "_comment": "Define common protocol messages",
        "file": "commonmessage.h.in",
        "name": "ping_message"
    },
    "requirements": {
        "discovery": "Discovery of connected devices, types, and firmwares",
        "packed_fields": "memory alignment"
    },
    "sensor_info": {
        "name": "Common"
    },
    "format": [
        {
            "name": "start1",
            "type": "u8",
            "index": "0",
            "description": "'B'"
        },
        {
            "name": "start2",
            "type": "u8",
            "index": "1",
            "description": "'R'"
        },
        {
            "name": "payload_length",
            "type": "u16",
            "index": "2-3",
            "description": "Number of bytes in payload."
        },
        {
            "name": "message_id",
            "type": "u16",
            "index": "4-5",
            "description": "The message id."
        },
        {
            "name": "src_device_id",
            "type": "u8",
            "index": "6",
            "description": "The device ID of the device sending the message."
        },
        {
            "name": "dst_device_id",
            "type": "u8",
            "index": "7",
            "description": "The device ID of the intended recipient of the message."
        },
        {
            "name": "payload",
            "type": "u8[]",
            "index": "8-n",
            "description": "The message payload."
        },
        {
            "name": "checksum",
            "type": "u16",
            "index": "(n+1)-(n+2)",
            "description": "The message checksum. The checksum is calculated as the sum of all the non-checksum bytes in the message."
        }
    ],
    "messages": {
        "general": {
            "ack": {
                "id": "1",
                "description": "Acknowledged.",
                "payload": [
                    {
                        "name": "acked_id",
                        "type": "u16",
                        "description": "The message ID that is ACKnowledged."
                    }
                ]
            },
            "nack": {
                "id": "2",
                "description": "Not acknowledged.",
                "payload": [
                    {
                        "name": "nacked_id",
                        "type": "u16",
                        "description": "The message ID that is Not ACKnowledged."
                    },
                    {
                        "name": "nack_message",
                        "type": "vector",
                        "vector": {
                            "datatype": "char",
                            "size": "dynamic"
                        },
                        "description": "ASCII text message indicating NACK condition. (not necessarily NULL terminated)"
                    }
                ]
            },
            "ascii_text": {
                "id": "3",
                "description": "A message for transmitting text data.",
                "payload": [
                    {
                        "name": "ascii_message",
                        "type": "vector",
                        "vector": {
                            "datatype": "char",
                            "size": "dynamic"
                        },
                        "description": "ASCII text message. (not necessarily NULL terminated)"
                    }
                ]
            },
            "general_request": {
                "id": "6",
                "description": "Requests a specific message to be sent from the sonar to the host. Command timeout should be set to 50 msec.",
                "payload": [
                    {
                        "name": "requested_id",
                        "type": "u16",
                        "description": "Message ID to be requested."
                    }
                ]
            }
        },
        "get": {
            "device_information": {
                "id": "4",
                "description": "Device information",
                "payload": [
                    {
                        "name": "device_type",
                        "type": "u8",
                        "description": "Device type. 0: Unknown; 1: Ping Echosounder; 2: Ping360"
                    },
                    {
                        "name": "device_revision",
                        "type": "u8",
                        "description": "device-specific hardware revision"
                    },
                    {
                        "name": "firmware_version_major",
                        "type": "u8",
                        "description": "Firmware version major number."
                    },
                    {
                        "name": "firmware_version_minor",
                        "type": "u8",
                        "description": "Firmware version minor number."
                    },
                    {
                        "name": "firmware_version_patch",
                        "type": "u8",
                        "description": "Firmware version patch number."
                    },
                    {
                        "name": "reserved",
                        "type": "u8",
                        "description": "reserved"
                    }
                ]
            },
            "protocol_version": {
                "id": "5",
                "description": "The protocol version",
                "payload": [
                    {
                        "name": "version_major",
                        "type": "u8",
                        "description": "Protocol version major number."
                    },
                    {
                        "name": "version_minor",
                        "type": "u8",
                        "description": "Protocol version minor number."
                    },
                    {
                        "name": "version_patch",
                        "type": "u8",
                        "description": "Protocol version patch number."
                    },
                    {
                        "name": "reserved",
                        "type": "u8",
                        "description": "reserved"
                    }
                ]
            }
        }
    }
}
